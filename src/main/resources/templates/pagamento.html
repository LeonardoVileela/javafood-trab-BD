<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml"
        lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, maximum-scale=1.00, initial-scale=1.0">
    <title>JAVAFOOD</title>
    <link rel="stylesheet" th:href="@{/cssIfood/pagamento.css}"/>
    <script th:src="@{/jsfood/jquery-3.6.0.min.js}" ></script>
    <!-- Toastr -->
    <link rel="stylesheet" th:href="@{/prototipo/plugins/toastr/toastr.min.css}" >
</head>

<body>

    <div class="checkout">
        <div class="credit-card-box">
            <div class="flip">
                <div class="front">
                    <div class="chip"></div>
                    <div class="logo">

                    </div>
                    <div class="number"></div>
                    <div class="card-holder">
                        <label>Titular do cartão</label>
                        <div></div>
                    </div>
                    <div class="card-expiration-date">
                        <label>Expira</label>
                        <div></div>
                    </div>
                </div>
                <div class="back">
                    <div class="strip"></div>
                    <div class="logo">


                    </div>
                    <div class="ccv">
                        <label>CCV</label>
                        <div></div>
                    </div>
                </div>
            </div>
        </div>
        <form id="formCard" th:object="${card}" method="POST" th:action="@{/cliente/pagamento/save}" class="form" autocomplete="off" novalidate>
            <fieldset>
                <label for="card-number">Número do cartão</label>
                <input name="number[]" inputmode="numeric" type="num" id="card-number" class="input-cart-number" maxlength="4" />
                <input name="number[]" inputmode="numeric" type="num" id="card-number-1" class="input-cart-number" maxlength="4" />
                <input name="number[]" inputmode="numeric" type="num" id="card-number-2" class="input-cart-number" maxlength="4" />
                <input name="number[]" inputmode="numeric" type="num" id="card-number-3" class="input-cart-number" maxlength="4" />
            </fieldset>
            <fieldset>
                <label for="card-holder">Titular do cartão</label>
                <input name="name" type="text" id="card-holder" />
            </fieldset>
            <fieldset class="fieldset-expiration">
                <label for="card-expiration-month">Data de validade</label>
                <div class="select">
                    <select name="data[]" id="card-expiration-month">
                        <option></option>
                        <option>01</option>
                        <option>02</option>
                        <option>03</option>
                        <option>04</option>
                        <option>05</option>
                        <option>06</option>
                        <option>07</option>
                        <option>08</option>
                        <option>09</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                    </select>
                </div>
                <div class="select">
                    <select name="data[]" id="card-expiration-year">
                        <option></option>
                        <option>2021</option>
                        <option>2022</option>
                        <option>2023</option>
                        <option>2024</option>
                        <option>2025</option>
                        <option>2026</option>
                        <option>2027</option>
                        <option>2028</option>
                        <option>2029</option>
                        <option>2030</option>
                    </select>
                </div>
            </fieldset>
            <fieldset class="fieldset-ccv">
                <label for="card-ccv">CCV</label>
                <input name="cvv" inputmode="numeric" type="text" id="card-ccv" maxlength="3" />
            </fieldset>
            <input id="bandeira" name="bandeira" type="text" hidden>
            <button type="button" onclick="submitForm()" class="btn">Pagar</button>
        </form>
    </div>

    <!-- Toastr -->
    <script th:src="@{/prototipo/plugins/toastr/toastr.min.js}"></script>

    <script>

        var bandeira = true;

        function submitForm() {
            var cardnumber = document.getElementById("card-number").value
            var cardnumber1 = document.getElementById("card-number-1").value
            var cardnumber2 = document.getElementById("card-number-2").value
            var cardnumber3 = document.getElementById("card-number-3").value

            var titular = document.getElementById("card-holder").value
            var cardMonth = document.getElementById("card-expiration-month").value
            var cardYear = document.getElementById("card-expiration-year").value
            var cardCVV = document.getElementById("card-ccv").value

            if (cardnumber == '' || cardnumber1 == '' || cardnumber2 == '' || cardnumber3 == ''  ) {
                toastr.error('O Número do cartão não pode ser vazio')

            } else if (isNaN(cardnumber) || isNaN(cardnumber1) || isNaN(cardnumber2) || isNaN(cardnumber3) ){
                toastr.error('Número do cartão é inválido')

            } else if(titular == ''){
                toastr.error('O nome do titular não pode ser vazia')

            } else if ( cardMonth == ''){
                toastr.error('O mês não pode ser vazio')

            } else if (cardYear == ''){
                toastr.error('O ano não pode ser vazio')
            } else if (cardCVV == ''){
                toastr.error('O CVV não pode ser vazio')
            } else if (isNaN(cardCVV)){
                toastr.error('O CVV é inválido')
            } else if (bandeira == false){
                toastr.error('Número do cartão é inválido')
            } else{
                document.getElementById("formCard").submit();
            }

        }



        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : evt.keyCode;

            if ((charCode >= 48 && charCode <= 57) || charCode <= 31) {
                return true;
            }

            return false;
        }

        $('.input-cart-number').on('keyup change', function () {
            $t = $(this);

            if (this.value.length == this.maxLength) {
                $(this).next('.input-cart-number').focus();
            }

            var card_number = '';
            $('.input-cart-number').each(function () {
                card_number += $(this).val() + ' ';
            })

            $('.credit-card-box .number').html(card_number);
        });

        $('#card-holder').on('keyup change', function () {
            $t = $(this);
            $('.credit-card-box .card-holder div').html($t.val());
        });

        $('#card-holder').on('keyup change', function () {
            $t = $(this);
            $('.credit-card-box .card-holder div').html($t.val());
        });

        $('#card-expiration-month, #card-expiration-year').change(function () {
            m = $('#card-expiration-month option').index($('#card-expiration-month option:selected'));
            m = (m < 10) ? '0' + m : m;
            y = $('#card-expiration-year').val().substr(2, 2);
            $('.card-expiration-date div').html(m + '/' + y);
        })

        $('#card-ccv').on('focus', function () {
            $('.credit-card-box').addClass('hover');
        }).on('blur', function () {
            $('.credit-card-box').removeClass('hover');
        }).on('keyup change', function () {
            $('.ccv div').html($(this).val());
        });

        function getCreditCardType(accountNumber) {
            if (/^5[1-5]/.test(accountNumber)) {
                bandeira = true;
                document.getElementById("bandeira").value = 'mastercard';

                $(".logoCartao").remove();
                $(".logo").append('<svg class="logoCartao" xmlns="http://www.w3.org/2000/svg" width="2.11676in" height="1.5in" viewBox="0 0 152.407 108">' +
                    '<g>' +
                    '<rect width="152.407" height="108" style="fill: none"/>' +
                    '<g>' +
                    '<rect x="60.4117" y="25.6968" width="31.5" height="56.6064" style="fill: #ff5f00"/>' +
                    '<path d="M382.20839,306a35.9375,35.9375,0,0,1,13.7499-28.3032,36,36,0,1,0,0,56.6064A35.938,35.938,0,0,1,382.20839,306Z" transform="translate(-319.79649 -252)" style="fill: #eb001b"/>' +
                    '<path d="M454.20349,306a35.99867,35.99867,0,0,1-58.2452,28.3032,36.00518,36.00518,0,0,0,0-56.6064A35.99867,35.99867,0,0,1,454.20349,306Z" transform="translate(-319.79649 -252)" style="fill: #f79e1b"/>' +
                    '<path d="M450.76889,328.3077v-1.1589h.4673v-.2361h-1.1901v.2361h.4675v1.1589Zm2.3105,0v-1.3973h-.3648l-.41959.9611-.41971-.9611h-.365v1.3973h.2576v-1.054l.3935.9087h.2671l.39351-.911v1.0563Z" transform="translate(-319.79649 -252)" style="fill: #f79e1b"/>' +
                    '</g>' +
                    '</g>' +
                    '</svg>');

                result = 'mastercard';
            } else if (/^4/.test(accountNumber)) {
                bandeira = true;
                document.getElementById("bandeira").value = 'visa';
                result = 'visa';
                $(".logoCartao").remove();

                $(".logo").append('<svg class="logoCartao" version="1.1" id="visa" xmlns="http://www.w3.org/2000/svg"' +
                    'xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="47.834px"' +
                    'height="47.834px" viewBox="0 0 47.834 47.834"' +
                    'style="enable-background:new 0 0 47.834 47.834;">' +
                    '<g>' +
                    '<g>' +
                    '<path d="M44.688,16.814h-3.004c-0.933,0-1.627,0.254-2.037,1.184l-5.773,13.074h4.083c0,0,0.666-1.758,0.817-2.143' +
                    'c0.447,0,4.414,0.006,4.979,0.006c0.116,0.498,0.474,2.137,0.474,2.137h3.607L44.688,16.814z M39.893,26.01' +
                    'c0.32-0.819,1.549-3.987,1.549-3.987c-0.021,0.039,0.317-0.825,0.518-1.362l0.262,1.23c0,0,0.745,3.406,0.901,4.119H39.893z' +
                    'M34.146,26.404c-0.028,2.963-2.684,4.875-6.771,4.875c-1.743-0.018-3.422-0.361-4.332-0.76l0.547-3.193l0.501,0.228' +
                    'c1.277,0.532,2.104,0.747,3.661,0.747c1.117,0,2.313-0.438,2.325-1.393c0.007-0.625-0.501-1.07-2.016-1.77' +
                    'c-1.476-0.683-3.43-1.827-3.405-3.876c0.021-2.773,2.729-4.708,6.571-4.708c1.506,0,2.713,0.31,3.483,0.599l-0.526,3.092' +
                    'l-0.351-0.165c-0.716-0.288-1.638-0.566-2.91-0.546c-1.522,0-2.228,0.634-2.228,1.227c-0.008,0.668,0.824,1.108,2.184,1.77' +
                    'C33.126,23.546,34.163,24.783,34.146,26.404z M0,16.962l0.05-0.286h6.028c0.813,0.031,1.468,0.29,1.694,1.159l1.311,6.304' +
                    'C7.795,20.842,4.691,18.099,0,16.962z M17.581,16.812l-6.123,14.239l-4.114,0.007L3.862,19.161' +
                    'c2.503,1.602,4.635,4.144,5.386,5.914l0.406,1.469l3.808-9.729L17.581,16.812L17.581,16.812z M19.153,16.8h3.89L20.61,31.066' +
                    'h-3.888L19.153,16.8z" />' +
                    '</g>' +
                    '</g>' +
                    '</svg>');


            } else if (/^(5018|5020|5038|6304|6759|676[1-3])/.test(accountNumber)) {
                bandeira = true;
                document.getElementById("bandeira").value = 'maestro';
                result = 'Maestro';

                $(".logoCartao").remove();
                $(".logo").append('<svg class="logoCartao" xmlns="http://www.w3.org/2000/svg" width="146.776" height="120.641" viewBox="0 0 146.776 120.641">' +
                    '<g>' +
                    '<rect width="146.776" height="120.641" style="fill: none"/>' +
                    '<g>' +
                    '<path d="M372.97079,350.9185v-5.9914a3.55354,3.55354,0,0,0-3.7545-3.7945,3.69772,3.69772,0,0,0-3.3551,1.6976,3.50632,3.50632,0,0,0-3.1555-1.6976,3.15709,3.15709,0,0,0-2.7959,1.418v-1.1783h-2.0771v9.5462h2.097v-5.2923a2.23259,2.23259,0,0,1,2.3366-2.5362c1.378,0,2.0771.8986,2.0771,2.5162v5.3123h2.097v-5.2923A2.25125,2.25125,0,0,1,368.777,343.09c1.41779,0,2.09689.8986,2.09689,2.5162v5.3123Zm11.70321-4.7732v-4.773h-2.07711v1.1583a3.62159,3.62159,0,0,0-3.0157-1.398,5.01888,5.01888,0,0,0,0,10.0257,3.62139,3.62139,0,0,0,3.0157-1.3981v1.1583H384.674Zm-7.72881,0a2.89047,2.89047,0,1,1,2.8957,3.0556A2.86354,2.86354,0,0,1,376.94519,346.1453Zm52.1715-5.0239a5.3805,5.3805,0,0,1,2.0486.3839,4.99816,4.99816,0,0,1,1.6296,1.0566,4.83745,4.83745,0,0,1,1.0766,1.5899,5.30278,5.30278,0,0,1,0,3.9871,4.83354,4.83354,0,0,1-1.0766,1.5902,4.99443,4.99443,0,0,1-1.6296,1.0564,5.65627,5.65627,0,0,1-4.0971,0,4.94,4.94,0,0,1-1.6249-1.0564,4.87929,4.87929,0,0,1-1.0716-1.5902,5.30784,5.30784,0,0,1,0-3.9871,4.88328,4.88328,0,0,1,1.0716-1.5899,4.9437,4.9437,0,0,1,1.6249-1.0566A5.38,5.38,0,0,1,429.11669,341.1214Zm0,1.9639a3.09937,3.09937,0,0,0-1.186.2243,2.80562,2.80562,0,0,0-.947.6278,2.927,2.927,0,0,0-.6281.9671,3.47314,3.47314,0,0,0,0,2.4821,2.924,2.924,0,0,0,.6281.9669,2.80464,2.80464,0,0,0,.947.628,3.24794,3.24794,0,0,0,2.3721,0,2.86167,2.86167,0,0,0,.952-.628,2.89613,2.89613,0,0,0,.63321-.9669,3.47328,3.47328,0,0,0,0-2.4821,2.899,2.899,0,0,0-.63321-.9671,2.86269,2.86269,0,0,0-.952-.6278A3.09988,3.09988,0,0,0,429.11669,343.0853Zm-33.1409,3.06c-.0199-2.9756-1.8573-5.0127-4.5334-5.0127a5.017,5.017,0,0,0,.1398,10.0256,5.8025,5.8025,0,0,0,3.9143-1.3381l-1.01849-1.5378a4.54855,4.54855,0,0,1-2.776.9985,2.65136,2.65136,0,0,1-2.856-2.3366h7.08989C395.95589,346.6846,395.97579,346.4251,395.97579,346.1453Zm-7.1097-.8387a2.45767,2.45767,0,0,1,2.5363-2.3166,2.37115,2.37115,0,0,1,2.41661,2.3166Zm15.8566-1.4977a6.15314,6.15314,0,0,0-2.9756-.8189c-1.1385,0-1.8174.4194-1.8174,1.1185,0,.6391.7189.8186,1.6177.9384l.9785.1398c2.07711.2996,3.33511,1.1783,3.33511,2.8559,0,1.8174-1.59761,3.1157-4.35361,3.1157a6.887,6.887,0,0,1-4.134-1.2385l.9785-1.6175a5.08619,5.08619,0,0,0,3.1755.9986c1.4178,0,2.1768-.4193,2.1768-1.1584,0-.5392-.5393-.8388-1.6775-.9985l-.97869-.1397c-2.13681-.2997-3.29511-1.2583-3.29511-2.8161,0-1.8973,1.5576-3.0556,3.9742-3.0556a7.138,7.138,0,0,1,3.8944.9987Zm9.9801-.5393h-3.395v4.3139c0,.9584.3395,1.5976,1.378,1.5976a3.83592,3.83592,0,0,0,1.8374-.5392l.599,1.7775a4.87991,4.87991,0,0,1-2.59619.7389c-2.45641,0-3.31511-1.3181-3.31511-3.5351v-4.3536h-1.9373v-1.8973h1.9373l-.0006-2.8957h2.0969l.0006,2.8957h3.395Zm7.188-2.137a4.43589,4.43589,0,0,1,1.478.2598l-.6391,1.9571a3.38388,3.38388,0,0,0-1.2981-.2397c-1.3581,0-2.0372.8788-2.0372,2.4564v5.3523h-2.0769v-9.5462h2.0571v1.1583a2.81526,2.81526,0,0,1,2.5162-1.398ZM436.27,349.5289a.9539.9539,0,0,1,.37619.0746.97775.97775,0,0,1,.3074.2037.95657.95657,0,0,1,.2071.3028.93363.93363,0,0,1,0,.737.96452.96452,0,0,1-.2071.3015.9964.9964,0,0,1-.3074.2048.93912.93912,0,0,1-.37619.0758.96809.96809,0,0,1-.89761-.5821.9359.9359,0,0,1,0-.737.96233.96233,0,0,1,.2062-.3028.95074.95074,0,0,1,.3085-.2037A.98158.98158,0,0,1,436.27,349.5289Zm0,1.6906a.70737.70737,0,0,0,.28659-.0582.75391.75391,0,0,0,.2327-.1583.74009.74009,0,0,0-.2327-1.205.7152.7152,0,0,0-.28659-.0572.74573.74573,0,0,0-.29221.0572.7297.7297,0,0,0-.2363.1569.74456.74456,0,0,0,0,1.0481.74452.74452,0,0,0,.52851.2165Zm.05589-1.1854a.40124.40124,0,0,1,.26211.0759.25268.25268,0,0,1,.09189.206.23989.23989,0,0,1-.0733.1803.349.349,0,0,1-.2085.0874l.2888.333h-.2258l-.2678-.3307h-.0862v.3307h-.1886v-.8826Zm-.2188.1655v.2352h.2166a.21318.21318,0,0,0,.1188-.0293.09949.09949,0,0,0,.0441-.0895.09807.09807,0,0,0-.0441-.0875.21492.21492,0,0,0-.1188-.0289Z" transform="translate(-322.61159 -245.6795)"/>' +
                    '<g>' +
                    '<rect x="57.6379" y="22.8343" width="31.5" height="56.6064" style="fill: #7375cf"/>' +
                    '<path d="M382.24969,296.817a35.93765,35.93765,0,0,1,13.7499-28.3032,36,36,0,1,0,0,56.6064A35.9378,35.9378,0,0,1,382.24969,296.817Z" transform="translate(-322.61159 -245.6795)" style="fill: #eb001b"/>' +
                    '<path d="M450.81019,319.1248v-1.1589h.4673v-.2361h-1.1901v.2361h.4675v1.1589Zm2.3105,0v-1.3973h-.3648l-.4196.9611-.4197-.9611h-.365v1.3973h.2576v-1.054l.3935.9087h.2671l.3935-.911v1.0563Z" transform="translate(-322.61159 -245.6795)" style="fill: #00a2e5"/>' +
                    '<path d="M454.24479,296.817a35.99867,35.99867,0,0,1-58.2452,28.3032,36.00518,36.00518,0,0,0,0-56.6064,35.99867,35.99867,0,0,1,58.2452,28.3032Z" transform="translate(-322.61159 -245.6795)" style="fill: #00a2e5"/>' +
                    '</g>' +
                    '</g>' +
                    '</g>' +
                    '</svg>');


            } else if (/^((((636368)|(438935)|(504175)|(451416)|(636297))\d{0,10})|((5067)|(4576)|(4011))\d{0,12})$/.test(accountNumber)) {
                bandeira = true;
                document.getElementById("bandeira").value = 'elo';
                result = 'Elo'

                $(".logoCartao").remove();
                $(".logo").append('<svg class="logoCartao" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"' +
                    'viewBox="0 0 2337.9 1104.7" style="enable-background:new 0 0 2337.9 1104.7;" xml:space="preserve">' +
                    '<style type="text/css">' +
                    '.st0{fill:#FFCB05;}' +
                    '.st1{fill:#00A4E0;}' +
                    '.st2{fill:#EF4123;}' +
                    '</style>' +
                    '<g>' +
                    '<g>' +
                    '<g>' +
                    '<path class="st0" d="M481.7,338.4c22.5-7.5,46.5-11.5,71.4-11.5c109,0,200,77.4,220.8,180.3l154.5-31.5' +
                    'c-35.4-174.8-190-306.4-375.3-306.4c-42.5,0-83.2,6.9-121.4,19.7L481.7,338.4z"/>' +
                    '<path class="st1" d="M299.4,839l104.5-118.1c-46.6-41.3-76-101.6-76-168.8c0-67.1,29.4-127.4,76-168.6L299.4,265.3' +
                    'C220.2,335.5,170.2,438,170.2,552.1C170.2,666.3,220.2,768.8,299.4,839"/>' +
                    '<path class="st2" d="M773.9,597.3C753,700.1,662.1,777.4,553.2,777.4c-25,0-49.1-4-71.5-11.6l-50,149.6' +
                    'c38.2,12.7,79,19.6,121.5,19.6c185.1,0,339.6-131.4,375.2-306L773.9,597.3z"/>' +
                    '</g>' +
                    '</g>' +
                    '<path d="M1063.5,725.8c-5.1-8.2-11.9-21.3-16.1-31c-24.5-56.8-25.6-115.6-5-172c22.7-61.9,66.1-109.2,122.2-133.4' +
                    'c70.5-30.3,148.4-24.4,216,15.7c42.9,24.6,73.3,62.6,96.4,116.4c2.9,6.9,5.5,14.2,8.1,20.5L1063.5,725.8z M1204.3,480.7' +
                    'c-50.1,21.5-75.9,68.5-70.5,123.5l212-91.3C1309.3,470.1,1261.9,455.9,1204.3,480.7z M1372.2,679.3c-0.1,0-0.1,0.1-0.1,0.1l-4.4-3' +
                    'c-12.7,20.5-32.4,37.2-57.3,48c-47.4,20.6-91.3,15.3-122.9-12.4l-2.9,4.4c0,0,0-0.1-0.1-0.1l-53.8,80.5' +
                    'c13.4,9.3,27.7,17.1,42.7,23.4c59.4,24.7,120.2,23.5,180.1-2.5c43.3-18.8,77.3-47.4,100.5-83.7L1372.2,679.3z"/>' +
                    '<path d="M1632.4,271v447.4l69.6,28.2l-39.5,92.2l-76.8-32c-17.2-7.5-29-18.9-37.8-31.8c-8.5-13.1-14.8-31.2-14.8-55.4V271H1632.4z"' +
                    '/>' +
                    '<g>' +
                    '<path d="M1812.6,604.5c0-38.1,16.9-72.3,43.5-95.5l-71.4-79.6c-48.4,42.8-78.9,105.3-78.9,174.9c-0.1,69.7,30.4,132.3,78.7,175.1' +
                    'l71.3-79.6C1829.3,676.5,1812.6,642.5,1812.6,604.5z"/>' +
                    '<path d="M1939.4,731.4c-14,0-27.6-2.4-40.2-6.6l-34.1,101.3c23.3,7.8,48.2,12.1,74.2,12.1c113,0.1,207.3-80.1,229.2-186.6' +
                    'l-104.8-21.4C2051.8,688.1,2000.7,731.5,1939.4,731.4z"/>' +
                    '<path d="M1939.7,370.8c-25.9,0-50.8,4.2-74.1,11.9l33.8,101.4c12.7-4.2,26.2-6.5,40.2-6.5c61.4,0.1,112.6,43.7,124.2,101.7' +
                    'l104.8-21.2C2147.1,451.4,2052.8,370.9,1939.7,370.8z"/>' +
                    '</g>' +
                    '</g>' +
                    '</svg>');

            } else {
                result = 'Nenhum'
                bandeira = false;

                $(".logoCartao").remove();
            }
            return result;
        }

        $('#card-number').change(function () {
            getCreditCardType($(this).val());
        })



    </script>
</body>

</html>